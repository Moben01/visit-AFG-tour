{% extends 'base.html' %}
{% load static %}
{% block content %}

<!-- Breadcrumb -->
<div class="breadcrumb-bar breadcrumb-bg-02 text-center">
    <div class="container">
        <div class="row">
            <div class="col-md-12 col-12">
                <h2 class="breadcrumb-title mb-2">Tour Details</h2>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb justify-content-center mb-0">
                        <li class="breadcrumb-item"><a href="index.html"><i class="isax isax-home5"></i></a></li>
                        <li class="breadcrumb-item">Tours</li>
                        <li class="breadcrumb-item active" aria-current="page">Tour Details</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>
</div>
<!-- /Breadcrumb -->

<!-- Page Wrapper -->
<div class="content">
    <div class="container">

        <div class="row">
            <div class="col-xl-8">

                <!-- Slider -->
                <div>
                    <div class="service-wrap mb-4">
                        <!-- Gallery -->
                        <!-- Swiper CSS -->
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

                        <style>
                            .swiper-slide {
                                display: flex;
                                justify-content: center;
                                align-items: center;
                                height: 250px;
                                background-color: #f8f9fa;
                                overflow: hidden;
                                border-radius: 12px;
                            }

                            .swiper-slide img {
                                width: 100%;
                                height: 100%;
                                object-fit: cover;
                                object-position: center;
                                border-radius: 12px;
                            }
                        </style>

                        <div class="bg-light-200 card-bg-light mb-4">
                            <h5 class="fs-18 mb-3">Gallery</h5>

                            {% if tour_images %}
                            <div class="swiper tourSwiper">
                                <div class="swiper-wrapper">
                                    {% for img in tour_images %}
                                    <div class="swiper-slide">
                                        <a data-fancybox="gallery" href="{{ img.image.url }}">
                                            <img src="{{ img.image.url }}" alt="Tour Image" />
                                        </a>
                                    </div>
                                    {% endfor %}
                                </div>

                                <!-- Controls -->
                                <div class="swiper-button-next"></div>
                                <div class="swiper-button-prev"></div>
                                <div class="swiper-pagination"></div>
                            </div>
                            {% else %}
                            <p>No images available for this tour.</p>
                            {% endif %}
                        </div>

                        <!-- Swiper JS -->
                        <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
                        <script>
                            const swiper = new Swiper('.tourSwiper', {
                                loop: true,
                                slidesPerView: 1,
                                spaceBetween: 10,
                                pagination: {
                                    el: '.swiper-pagination',
                                    clickable: true,
                                },
                                navigation: {
                                    nextEl: '.swiper-button-next',
                                    prevEl: '.swiper-button-prev',
                                },
                                breakpoints: {
                                    768: { slidesPerView: 2 },
                                    992: { slidesPerView: 3 },
                                },
                            });
                        </script>

                        <!-- /Gallery -->
                    </div>
                    <div class="d-flex align-items-center justify-content-between mb-2">
                        <div class="mb-2">
                            <h4 class="mb-1 d-flex align-items-center flex-wrap mb-2">{{get_tour.title}}<span
                                    class="badge badge-xs bg-success rounded-pill ms-2"><i
                                        class="isax isax-ticket-star me-1"></i>{% if get_tour.available == True %}
                                    Available {% endif %}</span></h4>
                            <div class="d-flex align-items-center flex-wrap">
                                <p class="fs-14 mb-2 me-3 pe-3 border-end"><i
                                        class="isax isax-location5 me-2"></i>{{get_tour.location}}
                                    <a href="#location"
                                        class="link-primary text-decoration-underline fw-medium ms-2">View Location</a>
                                </p>
                                <div class="d-flex align-items-center mb-2">
                                    <span
                                        class="badge badge-warning badge-xs text-gray-9 fs-13 fw-medium me-2">5.0</span>
                                    <p class="fs-14"><a href="#reviews">(400 Reviews)</a></p>
                                </div>
                            </div>
                        </div>
                        <div class="d-flex align-items-center mb-3">
     <!-- Share Button -->
<button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#shareModal">
  <i class="isax isax-share me-1"></i> Share
</button>

<!-- Share Modal -->
<div class="modal fade" id="shareModal" tabindex="-1" aria-labelledby="shareModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content p-4">
      <div class="modal-header border-0">
        <h5 class="modal-title" id="shareModalLabel">Share This Page</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body d-flex justify-content-around flex-wrap gap-3">

        <!-- Instagram -->
        <a href="https://www.instagram.com/" target="_blank" class="text-decoration-none text-center">
          <img src="https://cdn-icons-png.flaticon.com/512/2111/2111463.png" width="40" alt="Instagram">
        </a>

        <!-- Facebook -->
        <a href="#" id="fbShare" target="_blank" class="text-decoration-none text-center">
          <img src="https://cdn-icons-png.flaticon.com/512/733/733547.png" width="40" alt="Facebook">
        </a>

        <!-- Twitter -->
        <a href="#" id="twShare" target="_blank" class="text-decoration-none text-center">
          <img src="https://cdn-icons-png.flaticon.com/512/733/733579.png" width="40" alt="Twitter">
        </a>

        <!-- Pinterest -->
        <a href="https://pinterest.com/" target="_blank" class="text-decoration-none text-center">
          <img src="https://cdn-icons-png.flaticon.com/512/733/733646.png" width="40" alt="Pinterest">
        </a>

        <!-- LinkedIn -->
        <a href="#" id="liShare" target="_blank" class="text-decoration-none text-center">
          <img src="https://cdn-icons-png.flaticon.com/512/733/733561.png" width="40" alt="LinkedIn">
        </a>

        <!-- WhatsApp -->
        <a href="#" id="waShare" target="_blank" class="text-decoration-none text-center">
          <img src="https://cdn-icons-png.flaticon.com/512/733/733585.png" width="40" alt="WhatsApp">
        </a>

      </div>
    </div>
  </div>
</div>

<!-- Bootstrap JS (include if not already) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- JavaScript to Generate Share URLs -->
<script>
  const url = encodeURIComponent(window.location.href);
  const text = encodeURIComponent("Check out this page!");

  document.getElementById('fbShare').href = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
  document.getElementById('twShare').href = `https://twitter.com/intent/tweet?url=${url}&text=${text}`;
  document.getElementById('liShare').href = `https://www.linkedin.com/sharing/share-offsite/?url=${url}`;
  document.getElementById('waShare').href = `https://api.whatsapp.com/send?text=${text}%20${url}`;
</script>


                            <a href="javascript:void(0);"
                                class="btn btn-outline-light btn-sm d-inline-flex align-items-center"><i
                                    class="isax isax-heart5 text-danger me-1"></i>Save</a>
                            <a href="javascript:void(0);"
                                class="btn btn-outline-light btn-icon btn-sm d-flex align-items-center justify-content-center me-2"><i
                                    class="isax isax-share"></i></a>

                            <div id="favorite-button" hx-post="{% url 'tour:toggle_favorite' slug=get_tour.slug %}"
                                hx-target="#favorite-button" hx-swap="outerHTML">

                                {% if is_favorite %}
                                <button type="submit" class="btn btn-danger btn-sm">
                                    <i class="isax isax-heart5 me-1"></i>
                                </button>
                                {% else %}
                                <button type="submit" class="btn btn-outline-light btn-sm">
                                    <i class="isax isax-heart me-1"></i>
                                </button>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /Slider -->

                <!-- Description -->
                <div class="bg-light-200 card-bg-light mb-4">
                    <h5 class="fs-18 mb-3">Description</h5>
                    <div class="mb-2">
                        <p>
                            {{ get_tour.description }}
                        </p>
                    </div>
                </div>
                <!-- /Description -->

                <!-- Itinerary -->
                <div class="bg-light-200 card-bg-light mb-4">
                    <h5 class="fs-18 mb-3">Itinerary</h5>
                    <div class="card shadow-none mb-0">
                        <div class="card-body p-3">
                            <div class="stage-flow">
                                {% for i in find_Itinerary %}
                                <div class="d-flex align-items-center flows-step">
                                    <span class="flow-step">{{i.day_number}}</span>
                                    <div class="flow-content">
                                        <div class="d-flex align-items-center justify-content-between mb-2">
                                            <div>
                                                <h6 class="fw-medium mb-1">Day {{i.day_number}}, {{i.title}}</h6>
                                                <p>{{i.date}}</p>
                                            </div>
                                            <span class="avatar avatar-lg avatar-rounded flex-shrink-0"><img
                                                    src="{{ i.image.url }}" alt="Img"></span>
                                        </div>
                                        <p>
                                            {{i.description}}
                                        </p>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /Itinerary -->

                <!-- Includes & Excludes -->
                <div class="bg-light-200 card-bg-light mb-4">
                    <h5 class="fs-18 mb-3">Includes & Excludes</h5>
                    <div class="row gy-2">
                        <div class="col-md-6">
                            {% for i in Includess %}
                            <p class="d-flex align-items-center mb-2">
                                <i class="isax isax-tick-square5 text-success me-2"></i> {{i.title}}
                            </p>
                            {% endfor %}
                        </div>

                        <div class="col-md-6">
                            {% for i in Excludess %}
                            <p class="d-flex align-items-center mb-2">
                                <i class="isax isax-close-square5 text-danger me-2"></i> {{i.title}}
                            </p>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <!-- /Includes & Excludes -->

                <div class="bg-light-200 card-bg-light mb-4" id="location">
                    <h5 class="fs-18 mb-3">Location</h5>
                    <!-- Map -->
                    <div>
                        <iframe src="{{ get_tour.google_location }}" allowfullscreen="" loading="lazy"
                            referrerpolicy="no-referrer-when-downgrade" class="tour-detail-map w-100"></iframe>
                    </div>
                    <!-- /Map -->
                </div>

                <!-- FAQ -->
                <div class="bg-light-200 card-bg-light mb-4">
                    <h5 class="fs-18 mb-3">Frequently Asked Questions</h5>
                    <div class="accordion faq-accordion" id="accordionFaq">
                        {% for i in get_faqs %}
                        <div class="accordion-item show mb-2">
                            <div class="accordion-header">
                                <button class="accordion-button fw-medium" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#{{i.data_bs_target}}" aria-expanded="false"
                                    aria-controls="{{i.data_bs_target}}">
                                    {{i.question}}
                                </button>
                            </div>
                            <div id="{{i.data_bs_target}}" class="accordion-collapse collapse show"
                                data-bs-parent="#accordionFaq">
                                <div class="accordion-body">
                                    <p class="mb-0">
                                        {{i.answer}}
                                    </p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                <!-- /FAQ -->


                <div id="enquires-content">
                    {% include 'tour/partials/endquires_list.html' %}
                </div>

                <div class="text-center mb-4 mb-xl-0">
                    <a href="javascript:void(0);"
                        class="btn btn-primary btn-md d-inline-flex align-items-center justify-content-center mt-2">See
                        all 4,078 reviews<i class="isax isax-arrow-right-3 ms-1"></i></a>
                </div>
            </div>
            <!-- /Reviews -->

            <!-- Tour Sidebar -->
            <div class="col-xl-4 theiaStickySidebar">
                <div class="card bg-light-200">
                    <div class="card-body">
                        <h5 class="d-flex align-items-center fs-18 mb-3">
                            <span class="avatar avatar-md rounded-circle bg-primary me-2"><i
                                    class="isax isax-signpost5"></i></span>
                            Tour Details
                        </h5>
                        <div>
                            <div class="d-flex align-items-center justify-content-between details-info">
                                <h6 class="fw-medium">Date</h6>
                                <p class="flex-fill">{{get_tour.start_date}} - {{get_tour.end_date}}</p>
                            </div>
                            <!-- <div class="d-flex align-items-center justify-content-between details-info">
                                <h6 class="fw-medium">Destination</h6>
                                <p class="flex-fill">Eidnesburg</p>
                            </div> -->
                            <div class="d-flex align-items-center justify-content-between details-info">
                                <h6 class="fw-medium">Duration</h6>
                                <p class="flex-fill">{{get_tour.duration_days}}</p>
                            </div>
                            <!-- <div class="d-flex align-items-center justify-content-between details-info">
                                <h6 class="fw-medium">Departure</h6>
                                <p class="flex-fill">25 May 2025, 04:45 AM</p>
                            </div>
                            <div class="d-flex align-items-center justify-content-between details-info">
                                <h6 class="fw-medium">Return</h6>
                                <p class="flex-fill">31 May 2025, 10:00 PM</p>
                            </div> -->
                            <!-- <div class="d-flex align-items-center justify-content-between details-info">
                                <h6 class="fw-medium">Total Peoples</h6>
                                <p class="flex-fill">28</p>
                            </div> -->
                        </div>
                    </div>
                </div>

                <div class="card shadow-none">
                    <div class="card-body">
                        <h5 class="fs-18 mb-3">Why Book With Us</h5>
                        <div>
                            <p class="d-flex align-items-center mb-3"><i
                                    class="isax isax-medal-star text-primary me-2"></i>Expertise and Experience</p>
                            <p class="d-flex align-items-center mb-3"><i
                                    class="isax isax-menu text-primary me-2"></i>Tailored Services</p>
                            <p class="d-flex align-items-center mb-3"><i
                                    class="isax isax-message-minus text-primary me-2"></i>Comprehensive Planning</p>
                            <p class="d-flex align-items-center mb-3"><i
                                    class="isax isax-user-add text-primary me-2"></i>Client Satisfaction</p>
                            <p class="d-flex align-items-center"><i
                                    class="isax isax-grammerly text-primary me-2"></i>24/7 Support</p>
                        </div>
                    </div>
                </div>
                <div class="card shadow-none">
                    <div class="card-body">
                        <h5 class="fs-18 mb-3">Enquire Us</h5>
                        <div class="banner-form">
                            <form method="post" hx-post="{% url 'tour:tour_details' slug=get_tour.slug %}"
                                hx-target="#enquires-content" hx-swap="innerHTML">
                                <div class="mb-3">
                                    <label class="form-label">Name</label>
                                    {{form.full_name}}
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Email</label>
                                    {{form.email}}
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Phone</label>
                                    {{form.phone}}
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Subject</label>
                                    {{form.subject}}
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Message</label>
                                    {{form.message}}
                                </div>

                                <button type="submit" class="btn btn-primary btn-lg search-btn ms-0 w-100 fs-14">Submit
                                    Enquiry
                                    <span id="spinner" class="loader"></span>
                                </button>
                                {% if message %}
                                <div class="alert alert-success" id="enquiry-success">
                                    {{ message }}
                                </div>
                                {% endif %}
                                <style>
                                    .loader {
                                        display: none;
                                        /* hide initially */
                                        width: 24px;
                                        height: 24px;
                                        border: 3px solid #FFF;
                                        border-bottom-color: transparent;
                                        border-radius: 50%;
                                        box-sizing: border-box;
                                        animation: rotation 1s linear infinite;
                                        margin-left: 8px;
                                    }

                                    @keyframes rotation {
                                        0% {
                                            transform: rotate(0deg);
                                        }

                                        100% {
                                            transform: rotate(360deg);
                                        }
                                    }
                                </style>


                            </form>
                            <script>
                                const spinner = document.getElementById('spinner');
                              
                                // Show spinner when HTMX request starts
                                document.body.addEventListener('htmx:configRequest', function (event) {
                                  if (spinner) {
                                    spinner.style.display = 'inline-block';
                                  }
                                });
                              
                                // Hide spinner when HTMX request completes (success or failure)
                                document.body.addEventListener('htmx:afterRequest', function (event) {
                                  if (spinner) {
                                    spinner.style.display = 'none';
                                  }
                                });
                              </script>

                        </div>
                    </div>
                </div>
                <style>
                    /* Apply styles for all screen sizes */
                    #pwa-install-btn {
                        position: relative;
                        border-radius: 50px;
                        background: radial-gradient(circle at center, #ff6a00, #ff0080);
                        /* Starting blend */
                        color: #fff;
                        font-size: 15px;
                        font-weight: 600;
                        padding: 10px 25px;
                        margin-top: 10px;
                        font-family: XW_Zar_Bd_0;
                        z-index: 1;
                        overflow: hidden;
                        animation: centerColorBlend 6s ease-in-out infinite;
                        background-size: 200% 200%;
                        border: none;
                    }

                    /* Animated multicolor border */
                    #pwa-install-btn:after {
                        content: '';
                        position: absolute;
                        top: -4px;
                        left: -4px;
                        right: -4px;
                        bottom: -4px;
                        border-radius: 50px;
                        background: linear-gradient(60deg, #f79533, #f37055, #ef4e7b, #a166ab, #5073b8, #1098ad, #07b39b, #6fba82);
                        z-index: -1;
                        animation: animatedborder 3s linear infinite;
                        background-size: 300% 300%;
                    }

                    /* Border animation */
                    @keyframes animatedborder {
                        0% {
                            background-position: 0% 50%;
                        }

                        50% {
                            background-position: 100% 50%;
                        }

                        100% {
                            background-position: 0% 50%;
                        }
                    }

                    /* Center gradient animation */
                    @keyframes centerColorBlend {
                        0% {
                            background: radial-gradient(circle at center, #ff6a00, #ff0080);
                        }

                        33% {
                            background: radial-gradient(circle at center, #ff0080, #00c3ff);
                        }

                        66% {
                            background: radial-gradient(circle at center, #00c3ff, #00ff72);
                        }

                        100% {
                            background: radial-gradient(circle at center, #ff6a00, #ff0080);
                        }
                    }
                </style>

                <a href="{% url 'tour:tour_booking' get_tour.slug %}"
                    class="btn btn-primary btn-lg search-btn ms-0 w-100 fs-14 mb-4" id="pwa-install-btn">Book Now</a>

                <div class="card shadow-none mb-0">
                    <div class="card-body">
                        <h5 class="fs-18 mb-3">Provider Details</h5>
                        <div class="py-1">
                            <div class="bg-light-500 br-10 mb-3 d-flex align-items-center p-3">
                                <a href="javascript:void(0);" class="avatar avatar-lg flex-shrink-0">
                                    <img src="{% static 'img/users/user-05.jpg' %}" alt="img" class="rounded-circle">
                                </a>
                                <div class="ms-2 overflow-hidden">
                                    <h6 class="fw-medium text-truncate"><a href="javascript:void(0);">Adrian
                                            Hendriques</a></h6>
                                    <p class="fs-14">Member Since : 14 May 2024</p>
                                </div>
                            </div>
                            <div class="border br-10 mb-3 p-3">
                                <div class="d-flex align-items-center border-bottom pb-3 mb-3">
                                    <span class="avatar avatar-sm me-2 rounded-circle flex-shrink-0 bg-primary"><i
                                            class="isax isax-call-outgoing5"></i></span>
                                    <p>Call Us : +1 12545 45548</p>
                                </div>
                                <div class="d-flex align-items-center">
                                    <span class="avatar avatar-sm me-2 rounded-circle flex-shrink-0 bg-primary"><i
                                            class="isax isax-message-search5"></i></span>
                                    <p>Email : <a
                                            href="https://dreamstour.dreamstechnologies.com/cdn-cgi/l/email-protection"
                                            class="__cf_email__"
                                            data-cfemail="b5fcdbd3daf5d0cdd4d8c5d9d09bd6dad8">[email&#160;protected]</a>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="row g-2">
                            <div class="col-sm-6">
                                <a href="javascript:void(0);"
                                    class="btn btn-light d-flex align-items-center justify-content-center"><i
                                        class="isax isax-messages5 me-2"></i>Whatsapp Us</a>
                            </div>
                            <div class="col-sm-6">
                                <a href="chat.html"
                                    class="btn btn-primary d-flex align-items-center justify-content-center"><i
                                        class="isax isax-message-notif5 me-2"></i>Chat Now</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /Tour Sidebar -->

        </div>
    </div>
</div>
<!-- /Page Wrapper -->


{% endblock %}