{% extends 'tour/upcomming_tours/upcomming_tour_template.html'%}
{% load static %}


{% block main %}
     <div class="col-lg-9" style="padding-left: 25px;">
        {% if message %}
            <p class="text-success messages">{{ message }}</p>
            <script>
                setTimeout(function() {
                    $('.messages').fadeOut('slow');
                }, 9000);
            </script>
        {% endif %}


        {% if pickup and pickup.visible_to_tourist %}
    <div class="card mb-3">
      <div class="card-header d-flex justify-content-between align-items-center">
        <div>
          Status:
          <span class="badge bg-{% if pickup.status == 'picked_up' %}success{% elif pickup.status == 'waiting' %}info{% elif pickup.status == 'on_route' %}primary{% else %}secondary{% endif %}">
            {{ pickup.get_status_display }}
          </span>
        </div>
        {% if pickup.otp_code %}
          <div><strong>Pickup Code:</strong> {{ pickup.otp_code }}</div>
        {% endif %}
      </div>

      <div class="card-body">
        {% if pickup.welcome_note %}
          <div class="alert alert-success mb-3">{{ pickup.welcome_note }}</div>
        {% endif %}

        <div class="row g-3">
          <!-- Driver Card -->
          <div class="col-md-4">
            <div class="card h-100">
              {% if pickup.driver and pickup.driver.photo %}
                <img src="{{ pickup.driver.photo.url }}" class="card-img-top" alt="Driver photo">
              {% endif %}
              <div class="card-body">
                <h6 class="card-title mb-1">Driver</h6>
                <p class="mb-1"><strong>{{ pickup.driver.name }}</strong></p>
                {% if pickup.driver_phone_share or pickup.driver.phone %}
                  <p class="mb-1"><i class="fa fa-phone"></i>
                    {{ pickup.driver_phone_share|default:pickup.driver.phone }}
                  </p>
                {% endif %}
                {% if pickup.driver.languages %}<p class="text-muted small mb-0">{{ pickup.driver.languages }}</p>{% endif %}
                {% if pickup.driver.bio %}<p class="text-muted small mb-0">{{ pickup.driver.bio }}</p>{% endif %}
              </div>
            </div>
          </div>

          <!-- Operator Card -->
          <div class="col-md-4">
            <div class="card h-100">
              {% if pickup.operator and pickup.operator.photo %}
                <img src="{{ pickup.operator.photo.url }}" class="card-img-top" alt="Operator photo">
              {% endif %}
              <div class="card-body">
                <h6 class="card-title mb-1">Operator</h6>
                <p class="mb-1"><strong>{{ pickup.operator.name }}</strong></p>
                {% if pickup.operator_phone_share or pickup.operator.phone %}
                  <p class="mb-1"><i class="fa fa-phone"></i>
                    {{ pickup.operator_phone_share|default:pickup.operator.phone }}
                  </p>
                {% endif %}
                {% if pickup.operator.languages %}<p class="text-muted small mb-0">{{ pickup.operator.languages }}</p>{% endif %}
                {% if pickup.operator.bio %}<p class="text-muted small mb-0">{{ pickup.operator.bio }}</p>{% endif %}
              </div>
            </div>
          </div>

          <!-- Vehicle Card -->
          <div class="col-md-4">
            <div class="card h-100">
              {% if pickup.vehicle and pickup.vehicle.photo %}
                <img src="{{ pickup.vehicle.photo.url }}" class="card-img-top" alt="Vehicle photo">
              {% endif %}
              <div class="card-body">
                <h6 class="card-title mb-1">Vehicle</h6>
                {% if pickup.vehicle %}
                  <p class="mb-1"><strong>{{ pickup.vehicle.title }}</strong> {{ pickup.vehicle.plate_no }}</p>
                  {% if pickup.vehicle.color %}<p class="mb-1">Color: {{ pickup.vehicle.color }}</p>{% endif %}
                  <p class="text-muted small mb-0">Seats: {{ pickup.vehicle.capacity }}</p>
                {% else %}
                  <p class="text-muted mb-0">Will be assigned soon</p>
                {% endif %}
              </div>
            </div>
          </div>
        </div>

        <hr class="my-4">

        <div class="row g-3">
          <div class="col-md-6">
            <p><strong>Entry Point:</strong> {{ pickup.entry_point_label }}</p>
            <p><strong>Meeting Point:</strong> {{ pickup.meeting_point|default:"To be confirmed" }}</p>
          </div>
          <div class="col-md-6">
            <p><strong>Scheduled Time:</strong> {{ pickup.scheduled_at }}</p>
            <p class="text-muted">Pickup window Â± {{ pickup.window_minutes }} minutes</p>
          </div>
        </div>

        {% if pickup.meeting_note %}
          <div class="alert alert-info mt-3">{{ pickup.meeting_note }}</div>
        {% endif %}
      </div>
    </div>

    <!-- Internal edit button for staff / or if user is admin -->
    {% if request.user.is_staff %}
      <a class="btn btn-outline-secondary" href="{% url 'pickup_plan_edit' booking.id %}">Edit Pickup</a>
    {% endif %}

  {% else %}
    <div class="alert alert-info">Your pickup is being arranged. Please check back soon.</div>
    {% if request.user.is_staff %}
      <a class="btn btn-primary" href="{% url 'pickup_plan_edit' booking.id %}">Create Pickup Plan</a>
    {% endif %}
  {% endif %}
</div>

       




{% endblock %}